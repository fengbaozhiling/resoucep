!function(e,ha){var xb,qa,Ca,y,Da,Y,eb,ia,Z,Fa,Ga,fb,L,ra,sa,ja,S,Ra,ka,Sa,Ta,Ua,T,yb,gb,zb,Ab,$,Bb,Cb,Db,ta,Va,Eb,Fb,Gb,Ea;if(window.xheditor)return!1;if(xb=navigator.userAgent.toLowerCase().indexOf("mobile")>-1,qa=e.browser,Ca=parseFloat(qa.version),y=qa.msie,Da=qa.mozilla,Y=qa.safari,eb=qa.opera,e.fn.xheditor=function(B){if(xb)return!1;var A=[];return this.each(function(){if(e.nodeName(this,"TEXTAREA"))if(B===!1)this.xheditor&&(this.xheditor.remove(),this.xheditor=null);else if(this.xheditor)A.push(this.xheditor);else{var J=/({.*})/.exec(e(this).attr("class"));if(J){try{J=eval("("+J[1]+")")}catch(Qa){}B=e.extend({},J,B)}J=new Ea(this,B),J.init()&&(this.xheditor=J,A.push(J))}}),0===A.length&&(A=!1),1===A.length&&(A=A[0]),A},ia=0,Z=!1,Fa=!0,Ga=!1,fb=!1,e("script[src*=xheditor]").each(function(){var a=this.src;return a.match(/xheditor[^\/]*\.js/i)?(T=a.replace(/[\?#].*$/,"").replace(/(^|[\/\\])[^\/]*$/,"$1"),!1):void 0}),y)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(Kb){}yb={27:"esc",9:"tab",32:"space",13:"enter",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},gb=["#FFFFFF","#CCCCCC","#C0C0C0","#999999","#666666","#333333","#000000","#FFCCCC","#FF6666","#FF0000","#CC0000","#990000","#660000","#330000","#FFCC99","#FF9966","#FF9900","#FF6600","#CC6600","#993300","#663300","#FFFF99","#FFFF66","#FFCC66","#FFCC33","#CC9933","#996633","#663333","#FFFFCC","#FFFF33","#FFFF00","#FFCC00","#999900","#666600","#333300","#99FF99","#66FF99","#33FF33","#33CC00","#009900","#006600","#003300","#99FFFF","#33FFFF","#66CCCC","#00CCCC","#339999","#336666","#003333","#CCFFFF","#66FFFF","#33CCFF","#3366FF","#3333FF","#000099","#000066","#CCCCFF","#9999FF","#6666CC","#6633FF","#6600CC","#333399","#330099","#FFCCFF","#FF99FF","#CC66CC","#CC33CC","#993399","#663366","#330033"],zb=[{n:"p",t:"普通段落"},{n:"h1",t:"标题1"},{n:"h2",t:"标题2"},{n:"h3",t:"标题3"},{n:"h4",t:"标题4"},{n:"h5",t:"标题5"},{n:"h6",t:"标题6"},{n:"pre",t:"已编排格式"},{n:"address",t:"地址"}],Ab=[{n:"宋体",c:"SimSun"},{n:"仿宋体",c:"FangSong_GB2312"},{n:"黑体",c:"SimHei"},{n:"楷体",c:"KaiTi_GB2312"},{n:"微软雅黑",c:"Microsoft YaHei"},{n:"Arial"},{n:"Arial Black"},{n:"Comic Sans MS"},{n:"Courier New"},{n:"System"},{n:"Times New Roman"},{n:"Tahoma"},{n:"Verdana"}],$=[{n:"x-small",s:"10px",t:"极小"},{n:"small",s:"13px",t:"特小"},{n:"medium",s:"16px",t:"小"},{n:"large",s:"18px",t:"中"},{n:"x-large",s:"24px",t:"大"},{n:"xx-large",s:"32px",t:"特大"},{n:"-webkit-xxx-large",s:"48px",t:"极大"}],Bb=[{s:"左对齐",v:"justifyleft"},{s:"居中",v:"justifycenter"},{s:"右对齐",v:"justifyright"},{s:"两端对齐",v:"justifyfull"}],Cb=[{s:"数字列表",v:"insertOrderedList"},{s:"符号列表",v:"insertUnorderedList"}],Db={"default":{name:"默认",width:24,height:24,line:7,list:{smile:"微笑",tongue:"吐舌头",titter:"偷笑",laugh:"大笑",sad:"难过",wronged:"委屈",fastcry:"快哭了",cry:"哭",wail:"大哭",mad:"生气",knock:"敲打",curse:"骂人",crazy:"抓狂",angry:"发火",ohmy:"惊讶",awkward:"尴尬",panic:"惊恐",shy:"害羞",cute:"可怜",envy:"羡慕",proud:"得意",struggle:"奋斗",quiet:"安静",shutup:"闭嘴",doubt:"疑问",despise:"鄙视",sleep:"睡觉",bye:"再见"}}},ta={Cut:{t:"剪切 (Ctrl+X)"},Copy:{t:"复制 (Ctrl+C)"},Paste:{t:"粘贴 (Ctrl+V)"},Pastetext:{t:"粘贴文本",h:y?0:1},Blocktag:{t:"段落标签",h:1},Fontface:{t:"字体",h:1},FontSize:{t:"字体大小",h:1},Bold:{t:"加粗 (Ctrl+B)",s:"Ctrl+B"},Italic:{t:"斜体 (Ctrl+I)",s:"Ctrl+I"},Underline:{t:"下划线 (Ctrl+U)",s:"Ctrl+U"},Strikethrough:{t:"删除线"},FontColor:{t:"字体颜色",h:1},BackColor:{t:"背景颜色",h:1},SelectAll:{t:"全选 (Ctrl+A)"},Removeformat:{t:"删除文字格式"},Align:{t:"对齐",h:1},List:{t:"列表",h:1},Outdent:{t:"减少缩进"},Indent:{t:"增加缩进"},Link:{t:"超链接 (Ctrl+L)",s:"Ctrl+L",h:1},Unlink:{t:"取消超链接"},Anchor:{t:"锚点",h:1},Img:{t:"图片",h:1},Flash:{t:"Flash动画",h:1},Media:{t:"多媒体文件",h:1},Hr:{t:"插入水平线"},Emot:{t:"表情",s:"ctrl+e",h:1},Table:{t:"表格",h:1},Source:{t:"源代码"},Preview:{t:"预览"},Print:{t:"打印 (Ctrl+P)",s:"Ctrl+P"},Fullscreen:{t:"全屏编辑 (Esc)",s:"Esc"},About:{t:"关于 xhEditor"}},Va={mini:"Bold,Italic,Underline,Strikethrough,|,Align,List,|,Link,Img",simple:"Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,|,Align,List,Outdent,Indent,|,Link,Img,Emot,Table",medium:"Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,|,Align,List,Outdent,Indent,|,Link,Img,Flash,Media,Emot",full:"Cut,Copy,Paste,Pastetext,|,Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,SelectAll,Removeformat,|,Align,List,Outdent,Indent,|,Link,Unlink,Anchor,Img,Flash,Media,Hr,Emot,Table,|,Source,Preview,Print,Fullscreen"},Va.mfull=Va.full.replace(/\|(,Align)/i,"/$1"),Eb={a:"Link",img:"Img",embed:"Embed"},Fb={"<":"&lt;",">":"&gt;",'"':"&quot;","®":"&reg;","©":"&copy;"},Gb=/[<>"\u00ae\u00a9]/g,Ea=function(B,A){function J(a){a=a.target;var b=Eb[a.tagName.toLowerCase()];b&&("Embed"===b&&(b={"application/x-shockwave-flash":"Flash","application/x-mplayer2":"Media"}[a.type.toLowerCase()]),d.exec(b))}function Qa(a){return 27===a.which?(Ga?d.removeModal():Z&&d.hidePanel(),!1):void 0}function hb(){setTimeout(d.setSource,10)}function aa(){d.getSource()}function ib(a){var b,c,f,g,h;if(a&&(b=a.originalEvent.clipboardData)&&(c=b.items)&&(f=c[0])&&"file"==f.kind&&f.type.match(/^image\//i))return a=f.getAsFile(),b=new FileReader,b.onload=function(){var a='<img src="'+event.target.result+'">';a=jb(a),d.pasteHTML(a)},b.readAsDataURL(a),!1;if(g=p.cleanPaste,0===g||F||Wa)return!0;if(Wa=!0,d.saveBookmark(),b=y?"pre":"div",h=e("<"+b+' class="xhe-paste">﻿﻿</'+b+">",v).appendTo(v.body),b=h[0],c=d.getSel(),f=d.getRng(!0),h.css("top",ba.scrollTop()),y){if(f.moveToElementText(b),f.select(),f.execCommand("Paste"),"﻿﻿"==b.innerHTML)return h.remove(),void 0;a.preventDefault()}else f.selectNodeContents(b),c.removeAllRanges(),c.addRange(f);setTimeout(function(){var b,c,a=3===g;a?b=h.text():(c=[],e(".xhe-paste",v.body).each(function(a,b){0==e(b).find(".xhe-paste").length&&c.push(b.innerHTML)}),b=c.join("<br />")),h.remove(),d.loadBookmark(),a?d.pasteText(b):(b=d.cleanHTML(b),b=d.cleanWord(b),b=d.formatXHTML(b),(!p.onPaste||p.onPaste&&(b=p.onPaste(b))!==!1)&&(b=jb(b),d.pasteHTML(b))),Wa=!1},0)}function jb(a){var f,g,b=p.localUrlTest,c=p.remoteImgSaveUrl;return b&&c&&(f=[],g=0,a=a.replace(/(<img)((?:\s+[^>]*?)?(?:\s+src="\s*([^"]+)\s*")(?: [^>]*)?)(\/?>)/gi,function(a,c,d,e,h){return/^(https?|data:image)/i.test(e)&&!b.test(e)&&(f[g]=e,d=d.replace(/\s+(width|height)="[^"]*"/gi,"").replace(/\s+src="[^"]*"/gi,' src="'+Ha+'img/waiting.gif" remoteimg="'+g++ +'"')),c+d+h}),f.length>0&&e.post(c,{urls:f.join("|")},function(a){a=a.split("|"),e("img[remoteimg]",d.doc).each(function(){var b=e(this);U(b,"src",a[b.attr("remoteimg")]),b.removeAttr("remoteimg")})})),a}function Xa(a){try{d._exec("styleWithCSS",a,!0)}catch(b){try{d._exec("useCSS",!a,!0)}catch(c){}}}function Ya(){if(Za&&!F){Xa(!1);try{d._exec("enableObjectResizing",!0,!0)}catch(a){}if(y)try{d._exec("BackgroundImageCache",!0,!0)}catch(b){}}}function Hb(a){return F||13!==a.which||a.shiftKey||a.ctrlKey||a.altKey?!0:(a=d.getParent("p,h1,h2,h3,h4,h5,h6,pre,address,div,li"),a.is("li")?!0:p.forcePtag?(0===a.length&&d._exec("formatblock","<p>"),void 0):(d.pasteHTML("<br />"),y&&a.length>0&&2===d.getRng().parentElement().childNodes.length&&d.pasteHTML("<br />"),!1))}function $a(){Da||Y||(ua&&O.height("100%").css("height",O.outerHeight()-C.outerHeight()),y&&C.hide().show())}function Ib(a){if(a=a.target,a.tagName.match(/(img|embed)/i)){var b=d.getSel(),c=d.getRng(!0);c.selectNode(a),b.removeAllRanges(),b.addRange(c)}}function U(a,b,c){if(!b)return!1;var d="_xhe_"+b;return c&&(Ia&&(c=ca(c,Ia,P)),a.attr(b,P?ca(c,"abs",P):c).removeAttr(d).attr(d,c)),a.attr(d)||a.attr(b)}function ab(){Fa&&d.hidePanel()}function Jb(a){var b,c,f;if(F)return!0;b=a.which,c=yb[b],b=c?c:String.fromCharCode(b).toLowerCase(),sKey="",sKey+=a.ctrlKey?"ctrl+":"",sKey+=a.altKey?"alt+":"",sKey+=a.shiftKey?"shift+":"",sKey+=b,a=va[sKey];for(f in a){if(f=a[f],!e.isFunction(f))return d.exec(f),!1;if(f.call(d)===!1)return!1}}function V(a,b){var c=typeof a;return b?"array"===b&&a.hasOwnProperty&&a instanceof Array?!0:c===b:"undefined"!=c}function ca(a,b,c){var d,f,g,h,i;if(a.match(/^(\w+):\/\//i)&&!a.match(/^https?:/i)||a.match(/^#/i))return a;if(d=c?e('<a href="'+c+'" />')[0]:location,c=d.protocol,f=d.host,g=d.hostname,h=d.port,d=d.pathname.replace(/\\/g,"/").replace(/[^\/]+$/i,""),""===h&&(h="80"),""===d?d="/":"/"!==d.charAt(0)&&(d="/"+d),a=e.trim(a),"abs"!==b&&(a=a.replace(RegExp(c+"\\/\\/"+g.replace(/\./g,"\\.")+"(?::"+h+")"+("80"===h?"?":"")+"(/|$)","i"),"/")),"rel"===b&&(a=a.replace(RegExp("^"+d.replace(/([\/\.\+\[\]\(\)])/g,"\\$1"),"i"),"")),"rel"!==b&&(a.match(/^(https?:\/\/|\/)/i)||(a=d+a),"/"===a.charAt(0))){for(g=[],a=a.split("/"),i=a.length,d=0;i>d;d++)h=a[d],".."===h?g.pop():""!==h&&"."!==h&&g.push(h);""===a[i-1]&&g.push(""),a="/"+g.join("/")}return"abs"!==b||a.match(/^https?:\/\//i)||(a=c+"//"+f+a),a=a.replace(/(https?:\/\/[^:\/?#]+):80(\/|$)/i,"$1$2")}function kb(a,b){return"*"===b||a.match(RegExp(".("+b.replace(/,/g,"|")+")$","i"))?!0:(alert("上传文件扩展名必需为: "+b),!1)}function lb(a){var b=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(b))).toFixed(2)+["Byte","KB","MB","GB","TB","PB"][b]}function W(){return!1}function getByteCount(a){var d,b=0,c=a.split("");for(d=0;d<c.length;d++)c[d].charCodeAt(0)<299?b++:b+=2;return b}var C,O,la,ba,v,ma,na,bb,Ja,ob,pb,ya,qb,rb,sb,Ma,za,pa,Ha,Na,Ia,P,ea,db,va,d=this,Q=e(B),mb=Q.closest("form"),Za=!1,F=!1,ua=!1,Wa=!1,wa=!1,nb="",M=null,xa=!1,cb=!1,oa=null,da=null,X=0,p=d.settings=e.extend({},Ea.settings,A),Ka=p.plugins,La=[];Ka&&(ta=e.extend({},ta,Ka),e.each(Ka,function(a){La.push(a)}),La=La.join(",")),p.tools.match(/^\s*(m?full|medium|simple|mini)\s*$/i)&&(ob=Va[e.trim(p.tools)],p.tools=p.tools.match(/m?full/i)&&Ka?ob.replace("Table","Table,"+La):ob),p.tools.match(/(^|,)\s*About\s*(,|$)/i)||(p.tools+=",About"),p.tools=p.tools.split(","),p.editorRoot&&(T=p.editorRoot),T=ca(T,"abs"),p.urlBase&&(p.urlBase=ca(p.urlBase,"abs")),pb="xheCSS_"+p.skin,ya="xhe"+ia+"_container",qb="xhe"+ia+"_Tool",rb="xhe"+ia+"_iframearea",sb="xhe"+ia+"_iframe",Ma="xhe"+ia+"_fixffcursor",za="",pa="",Ha=T+"xheditor_skin/"+p.skin+"/",Na=Db,Ia=p.urlType,P=p.urlBase,ea=p.emotPath,ea=ea?ea:T+"xheditor_emot/",db="",Na=e.extend({},Na,p.emots),ea=ca(ea,"rel",P?P:null),(wa=p.showBlocktag)&&(pa+=" showBlocktag"),va=[],this.init=function(){var a,b,f,g,c,h,i,k,l;if(0===e("#"+pb).length&&e("head").append('<link id="'+pb+'" rel="stylesheet" type="text/css" href="'+Ha+'ui.css" />'),a=Q.outerWidth(),b=Q.outerHeight(),a=p.width||B.style.width||(a>10?a:0),X=p.height||B.style.height||(b>10?b:150),V(a,"number")&&(a+="px"),V(X,"string")&&(X=X.replace(/[^\d]+/g,"")),b=p.background||B.style.background,c=['<span class="xheGStart"/>'],h=/\||\//i,e.each(p.tools,function(a,b){if(b.match(h)&&c.push('<span class="xheGEnd"/>'),"|"===b)c.push('<span class="xheSeparator"/>');else if("/"===b)c.push("<br />");else{if(f=ta[b],!f)return;g=f.c?f.c:"xheIcon xheBtn"+b,c.push('<span><a href="#" title="'+f.t+'" cmd="'+b+'" class="xheButton xheEnabled" tabindex="-1" role="button"><span class="'+g+'" unselectable="on" style="font-size:0;color:transparent;text-indent:-999px;">'+f.t+"</span></a></span>"),f.s&&d.addShortcuts(f.s,b)}b.match(h)&&c.push('<span class="xheGStart"/>')}),c.push('<span class="xheGEnd"/><br />'),Q.after(e('<input type="text" id="'+Ma+'" style="position:absolute;display:none;" /><span id="'+ya+'" class="xhe_'+p.skin+'" style="display:none"><table cellspacing="0" cellpadding="0" class="xheLayout" style="'+("0px"!=a?"width:"+a+";":"")+"height:"+X+'px;" role="presentation"><tr><td id="'+qb+'" class="xheTool" unselectable="on" style="height:1px;" role="presentation"></td></tr><tr><td id="'+rb+'" class="xheIframeArea" role="presentation"><iframe frameborder="0" id="'+sb+'" src="javascript:;" style="width:100%;"></iframe></td></tr></table></span>')),C=e("#"+qb),O=e("#"+rb),za='<meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/><link rel="stylesheet" href="'+Ha+'iframe.css"/>',a=p.loadCSS)if(V(a,"array"))for(i in a)za+='<link rel="stylesheet" href="'+a[i]+'"/>';else za+=a.match(/\s*<style(\s+[^>]*?)?>[\s\S]+?<\/style>\s*/i)?a:'<link rel="stylesheet" href="'+a+'"/>';if(i="<html><head>"+za+"<title>可视化编辑器,alt+1到9键,切换到工具区,tab键,选择按钮,esc键,返回编辑 "+(p.readTip?p.readTip:"")+"</title>",b&&(i+="<style>body{background:"+b+";}</style>"),i+='</head><body spellcheck="0" class="editMode'+pa+'"></body></html>',d.win=la=e("#"+sb)[0].contentWindow,ba=e(la),la)try{this.doc=v=la.document,ma=e(v),v.open(),v.write(i),v.close(),y?v.body.contentEditable="true":v.designMode="On"}catch(j){}return k=this.doc.body,this.settings.innerCheck&&(k.addEventListener?(k.addEventListener("keyup",function(){"object"==typeof editor&&editor.checkInner()},!1),k.addEventListener("keydown",function(){"object"==typeof editor&&editor.checkInner()},!1)):(k.attachEvent("onkeydown",function(){"object"==typeof editor&&editor.checkInner()},!1),k.attachEvent("onkeyup",function(){"object"==typeof editor&&editor.checkInner()}))),setTimeout(Ya,300),d.setSource(),la.setInterval=null,C.append(c.join("")).bind("mousedown contextmenu",W).click(function(a){var b=e(a.target).closest("a");return b.is(".xheEnabled")&&(clearTimeout(Ja),C.find("a").attr("tabindex","-1"),M=a,d.exec(b.attr("cmd"))),!1}),C.find(".xheButton").hover(function(a){var g,b=e(this),c=p.hoverExecDelay,f=da;return da=null,-1===c||xa||!b.is(".xheEnabled")?!1:f&&f>10?(xa=!0,setTimeout(function(){xa=!1},100),!1):(g=b.attr("cmd"),1!==ta[g].h?(d.hidePanel(),!1):(cb&&(c=0),c>=0&&(Ja=setTimeout(function(){M=a,oa={x:M.clientX,y:M.clientY},d.exec(g)},c)),void 0))},function(){oa=null,Ja&&clearTimeout(Ja)}).mousemove(function(a){if(oa){var b={x:a.clientX-oa.x,y:a.clientY-oa.y};(Math.abs(b.x)>1||Math.abs(b.y)>1)&&(b.x>0&&b.y>0?(b=Math.round(Math.atan(b.y/b.x)/.017453293),da=da?(da+b)/2:b):da=null,oa={x:a.clientX,y:a.clientY})}}),L=e("#xhePanel"),ra=e("#xheShadow"),sa=e("#xheCntLine"),0===L.length&&(L=e('<div id="xhePanel"></div>').mousedown(function(a){a.stopPropagation()}),ra=e('<div id="xheShadow"></div>'),sa=e('<div id="xheCntLine"></div>'),setTimeout(function(){e(document.body).append(L).append(ra).append(sa)},10)),e("#"+ya).show(),Q.hide(),O.css("height",X-C.outerHeight()),y&8>Ca&&setTimeout(function(){O.css("height",X-C.outerHeight())},1),Q.focus(d.focus),mb.submit(aa).bind("reset",hb),p.submitID&&e("#"+p.submitID).click(aa),e(window).bind("unload beforeunload",aa).bind("resize",$a),e(document).mousedown(ab),k||(e(document).keydown(Qa),k=!0),ba.focus(function(){p.focus&&p.focus()}).blur(function(){p.blur&&p.blur()}),Y&&ba.click(Ib),ma.mousedown(ab).keydown(Jb).keypress(Hb).dblclick(J).bind("mousedown click",function(a){Q.trigger(a.type)}),y&&(ma.keydown(function(a){var b=d.getRng();return 8===a.which&&b.item?(e(b.item(0)).remove(),!1):void 0}),l=function(a){a=e(a.target);var b;(b=a.css("width"))&&a.css("width","").attr("width",b.replace(/[^0-9%]+/g,"")),(b=a.css("height"))&&a.css("height","").attr("height",b.replace(/[^0-9%]+/g,""))},ma.bind("controlselect",function(a){a=a.target,e.nodeName(a,"IMG")&&e(a).unbind("resizeend",l).bind("resizeend",l)})),ma.keydown(function(a){var b=a.which;return a.altKey&&b>=49&&57>=b?(C.find("a").attr("tabindex","0"),C.find(".xheGStart").eq(b-49).next().find("a").focus(),v.title="﻿﻿",!1):void 0}).click(function(){C.find("a").attr("tabindex","-1")}),C.keydown(function(a){var b=a.which;if(27==b)C.find("a").attr("tabindex","-1"),d.focus();else if(a.altKey&&b>=49&&57>=b)return C.find(".xheGStart").eq(b-49).next().find("a").focus(),!1}),i=e(v.documentElement),eb?i.bind("keydown",function(a){a.ctrlKey&&86===a.which&&ib()}):i.bind("paste",ib),p.disableContextmenu&&i.bind("contextmenu",W),p.html5Upload&&i.bind("dragenter dragover",function(a){var b;return(b=a.originalEvent.dataTransfer.types)&&-1!==e.inArray("Files",b)?!1:void 0}).bind("drop",function(a){var b,c,f,h,g;if(a=a.originalEvent.dataTransfer,a&&(b=a.files)&&b.length>0){a=["Link","Img","Flash","Media"],g=[];for(c in a)f=a[c],p["up"+f+"Url"]&&p["up"+f+"Url"].match(/^[^!].*/i)&&g.push(f+":,"+p["up"+f+"Ext"]);return 0===g.length?!1:(h=g.join(","),f=function(a){var b,d;for(c=0;c<a.length;c++){if(b=a[c].fileName.replace(/.+\./,""),!(b=h.match(RegExp("(\\w+):[^:]*,"+b+"(?:,|$)","i"))))return 1;if(d){if(d!==b[1])return 2}else d=b[1]}return d}(b),1===f?alert("上传文件的扩展名必需为："+h.replace(/\w+:,/g,"")):2===f?alert("每次只能拖放上传同一类型文件"):f&&d.startUpload(b,p["up"+f+"Url"],"*",function(a){var g,b=[];(g=p.onUpload)&&g(a);for(c in a)g=a[c],url=V(g,"string")?g:g.url,"!"===url.substr(0,1)&&(url=url.substr(1)),b.push(url);d.exec(f),e("#xhe"+f+"Url").val(b.join(" ")),e("#xheSave").click()}),!1)}}),(i=p.shortcuts)&&e.each(i,function(a,b){d.addShortcuts(a,b)}),ia++,Za=!0,p.fullscreen?d.toggleFullscreen():p.sourceMode&&setTimeout(d.toggleSource,20),!0},this.remove=function(){d.hidePanel(),aa(),Q.unbind("focus",d.focus),mb.unbind("submit",aa).unbind("reset",hb),p.submitID&&e("#"+p.submitID).unbind("mousedown",aa),e(window).unbind("unload beforeunload",aa).unbind("resize",$a),e(document).unbind("mousedown",ab),e("#"+ya).remove(),e("#"+Ma).remove(),Q.show(),Za=!1},this.saveBookmark=function(){if(!F){d.focus();var a=d.getRng();a=a.cloneRange?a.cloneRange():a,na={top:ba.scrollTop(),rng:a}}},this.loadBookmark=function(){var a,b;!F&&na&&(d.focus(),a=na.rng,y?a.select():(b=d.getSel(),b.removeAllRanges(),b.addRange(a)),ba.scrollTop(na.top),na=null)},this.focus=function(){if(F?e("#sourceCode",v).focus():ba.focus(),y){var a=d.getRng();a.parentElement&&a.parentElement().ownerDocument!==v&&d.setTextCursor()}return!1},this.setTextCursor=function(a){var e,b=d.getRng(!0),c=v.body;if(y)b.moveToElementText(c);else{for(e=a?"lastChild":"firstChild";3!=c.nodeType&&c[e];)c=c[e];b.selectNode(c)}b.collapse(a?!1:!0),y?b.select():(a=d.getSel(),a.removeAllRanges(),a.addRange(b))},this.getSel=function(){return v.selection?v.selection:la.getSelection()},this.getRng=function(a){var b,c;try{a||(b=d.getSel(),c=b.createRange?b.createRange():b.rangeCount>0?b.getRangeAt(0):null),c||(c=v.body.createTextRange?v.body.createTextRange():v.createRange())}catch(e){}return c},this.getParent=function(a){var c,b=d.getRng();return y?c=b.item?b.item(0):b.parentElement():(c=b.commonAncestorContainer,b.collapsed||b.startContainer===b.endContainer&&b.startOffset-b.endOffset<2&&b.startContainer.hasChildNodes()&&(c=b.startContainer.childNodes[b.startOffset])),a=a?a:"*",c=e(c),c.is(a)||(c=e(c).closest(a)),c},this.getSelect=function(a){var b=d.getSel(),c=d.getRng(),f=!0;return f=!c||c.item?!1:!b||0===c.boundingWidth||c.collapsed,"text"===a?f?"":c.text||(b.toString?b.toString():""):(c.cloneContents?(a=e("<div></div>"),(c=c.cloneContents())&&a.append(c),c=a.html()):c=V(c.item)?c.item(0).outerHTML:V(c.htmlText)?c.htmlText:c.toString(),f&&(c=""),c=d.processHTML(c,"read"),c=d.cleanHTML(c),c=d.formatXHTML(c))},this.pasteHTML=function(a,b){var c,f,g,h;if(F)return!1;if(d.focus(),a=d.processHTML(a,"write"),c=d.getSel(),f=d.getRng(),b!==ha&&(f.item&&(g=f.item(0),f=d.getRng(!0),f.moveToElementText(g),f.select()),f.collapse(b)),a+="<"+(y?"img":"span")+' id="_xhe_temp" width="0" height="0" />',f.insertNode){if(e(f.startContainer).closest("style,script").length>0)return!1;f.deleteContents(),f.insertNode(f.createContextualFragment(a))}else"control"===c.type.toLowerCase()&&(c.clear(),f=d.getRng()),f.pasteHTML(a);g=e("#_xhe_temp",v),h=g[0],y?(f.moveToElementText(h),f.select()):(f.selectNode(h),c.removeAllRanges(),c.addRange(f)),g.remove()},this.pasteText=function(a,b){a||(a=""),a=d.domEncode(a),a=a.replace(/\r?\n/g,"<br />"),d.pasteHTML(a,b)},this.appendHTML=function(a){return F?!1:(d.focus(),a=d.processHTML(a,"write"),e(v.body).append(a),d.setTextCursor(!0),void 0)},this.domEncode=function(a){return a.replace(Gb,function(a){return Fb[a]})},this.setSource=function(a){na=null,"string"!=typeof a&&""!==a&&(a=B.value),F?e("#sourceCode",v).val(a):(p.beforeSetSource&&(a=p.beforeSetSource(a)),a=d.cleanHTML(a),a=d.formatXHTML(a),a=d.processHTML(a,"write"),y?(v.body.innerHTML='<img id="_xhe_temp" width="0" height="0" />'+a+"\n",e("#_xhe_temp",v).remove()):v.body.innerHTML=a)},this.processHTML=function(a,b){var c,d,e;if("write"===b)a=a.replace(/(<(\/?)(\w+))((?:\s+[\w\-:]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*((\/?)>)/g,function(a,b,c,d,e,f,g){var h,i,j,k;return d=d.toLowerCase(),Da?"strong"===d?d="b":"em"===d&&(d="i"):Y&&("strong"===d?(d="span",c||(e+=' class="Apple-style-span" style="font-weight: bold;"')):"em"===d?(d="span",c||(e+=' class="Apple-style-span" style="font-style: italic;"')):"u"===d?(d="span",c||(e+=' class="Apple-style-span" style="text-decoration: underline;"')):"strike"===d&&(d="span",c||(e+=' class="Apple-style-span" style="text-decoration: line-through;"'))),i="","del"===d?d="strike":"img"===d?e=e.replace(/\s+emot\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,function(a,b){return h=b.match(/^(["']?)(.*)\1/)[2],h=h.split(","),h[1]||(h[1]=h[0],h[0]=""),"default"===h[0]&&(h[0]=""),p.emotMark?a:""}):"a"===d?(!e.match(/ href=[^ ]/i)&&e.match(/ name=[^ ]/i)&&(i+=" xhe-anchor"),g&&(f="></a>")):"table"!==d||c||(a=e.match(/\s+border\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i),(!a||a[1].match(/^(["']?)\s*0\s*\1$/))&&(i+=" xhe-border")),e=e.replace(/\s+([\w\-:]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(a,b,c){return b=b.toLowerCase(),c=c.match(/^(["']?)(.*)\1/)[2],aft="",y&&b.match(/^(disabled|checked|readonly|selected)$/)&&c.match(/^(false|0)$/i)?"":"img"===d&&h&&"src"===b?"":(b.match(/^(src|href)$/)&&(aft=" _xhe_"+b+'="'+c+'"',P&&(c=ca(c,"abs",P))),i&&"class"===b&&(c+=" "+i,i=""),Y&&"style"===b&&"span"===d&&c.match(/(^|;)\s*(font-family|font-size|color|background-color)\s*:\s*[^;]+\s*(;|$)/i)&&(j=!0)," "+b+'="'+c+'"'+aft)}),h&&(a=ea+(h[0]?h[0]:"default")+"/"+h[1]+".gif",k=p.admin?p.admin:"",e+=' src="'+k+a+'" _xhe_src="'+a+'"'),j&&(e+=' class="Apple-style-span"'),i&&(e+=' class="'+i+'"'),"<"+c+d+e+f}),y&&(a=a.replace(/&apos;/gi,"&#39;")),Y||(c=function(a,b,c,d){var e,f,g;if(b="",(e=c.match(/font-family\s*:\s*([^;"]+)/i))&&(b+=' face="'+e[1]+'"'),e=c.match(/font-size\s*:\s*([^;"]+)/i)){for(e=e[1].toLowerCase(),g=0;g<$.length;g++)if(e===$[g].n||e===$[g].s){f=g+1;break}f&&(b+=' size="'+f+'"',c=c.replace(/(^|;)(\s*font-size\s*:\s*[^;"]+;?)+/gi,"$1"))}if(f=c.match(/(?:^|[\s;])color\s*:\s*([^;"]+)/i)){if(e=f[1].match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i))for(f[1]="#",g=1;3>=g;g++)f[1]+=(e[g]-0).toString(16);f[1]=f[1].replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3"),b+=' color="'+f[1]+'"'}return c=c.replace(/(^|;)(\s*(font-family|color)\s*:\s*[^;"]+;?)+/gi,"$1"),""!==b?(c&&(b+=' style="'+c+'"'),"<font"+b+">"+d+"</font>"):a},a=a.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,c),a=a.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,c),a=a.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)?\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,c)),a=a.replace(/<(td|th)(\s+[^>]*?)?>(\s|&nbsp;)*<\/\1>/gi,"<$1$2>"+(y?"":"<br />")+"</$1>");else{if(Y)for(d=[{r:/font-weight:\sbold/gi,t:"strong"},{r:/font-style:\sitalic/gi,t:"em"},{r:/text-decoration:\sunderline/gi,t:"u"},{r:/text-decoration:\sline-through/gi,t:"strike"}],c=function(a,b,c,e,f){if(b=c+e,c="",!b)return f;for(e=0;e<d.length;e++)if(b.match(d[e].r)){c=d[e].t;break}return c?"<"+c+">"+f+"</"+c+">":a},e=0;2>e;e++)a=a.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,c),a=a.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,c),a=a.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,c);a=a.replace(/(<(\w+))((?:\s+[\w\-:]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/g,function(a,b,c,d,e){c=c.toLowerCase();var f;return d=d.replace(/\s+_xhe_(?:src|href)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,function(a,b){return f=b.match(/^(["']?)(.*)\1/)[2],""}),f&&Ia&&(f=ca(f,Ia,P)),d=d.replace(/\s+([\w\-:]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(a,b,c){if(b=b.toLowerCase(),c=c.match(/^(["']?)(.*)\1/)[2],"class"===b){if(c.match(/^["']?(apple|webkit)/i))return"";if(c=c.replace(/\s?xhe-[a-z]+/gi,""),""===c)return""}else{if(b.match(/^((_xhe_|_moz_|_webkit_)|jquery\d+)/i))return"";if(f&&b.match(/^(src|href)$/i))return" "+b+'="'+f+'"';"style"===b&&(c=c.replace(/(^|;)\s*(font-size)\s*:\s*([a-z-]+)\s*(;|$)/i,function(a,b,c,d,e){for(var f,g=0;g<$.length;g++)if(a=$[g],d===a.n){f=a.s;break}return b+c+":"+f+e}))}return" "+b+'="'+c+'"'}),"img"!==c||d.match(/\s+alt\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i)||(d+=' alt=""'),b+d+e}),a=a.replace(/(<(td|th)(?:\s+[^>]*?)?>)\s*([\s\S]*?)(<br(\s*\/)?>)?\s*<\/\2>/gi,function(a,b,c,d){return b+(d?d:"&nbsp;")+"</"+c+">"}),a=a.replace(/^\s*(?:<(p|div)(?:\s+[^>]*?)?>)?\s*(<span(?:\s+[^>]*?)?>\s*<\/span>|<br(?:\s+[^>]*?)?>|&nbsp;)*\s*(?:<\/\1>)?\s*$/i,"")}return a=a.replace(/(<pre(?:\s+[^>]*?)?>)([\s\S]+?)(<\/pre>)/gi,function(a,b,c,d){return b+c.replace(/<br\s*\/?>/gi,"\r\n")+d})},this.getSource=function(a){var b,c=p.beforeGetSource;return F?(b=e("#sourceCode",v).val(),c||(b=d.formatXHTML(b,!1))):(b=d.processHTML(v.body.innerHTML,"read"),b=d.cleanHTML(b),b=d.formatXHTML(b,a),c&&(b=c(b))),B.value=b},this.cleanWord=function(a){var c,b=p.cleanPaste;if(b>0&&3>b&&a.match(/mso(-|normal)|WordDocument|<table\s+[^>]*?x:str/i))for(a=a.replace(/<!--[\s\S]*?--\>|<!(--)?\[[\s\S]+?\](--)?>|<style(\s+[^>]*?)?>[\s\S]*?<\/style>/gi,""),a=a.replace(/\r?\n/gi,""),a=a.replace(/(<(\/?)([\w\-:]+))((?:\s+[\w\-:]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))?)*)\s*(\/?>)/g,function(a,c,d,f,g,h){return f=f.toLowerCase(),f.match(/^(link|img)$/)&&g.match(/file:\/\//i)||f.match(/:/)||"span"===f&&2===b?"":(d||(g=g.replace(/\s([\w\-:]+)(?:\s*=\s*("[^"]*"|'[^']*'|[^>\s]+))?/gi,function(a,c,d){return c=c.toLowerCase(),d=d.match(/^(["']?)(.*)\1/)[2],c.match(/:/)?"":c.match(/^(class|lang|language|span)$/)?"":"td"!==f||"height"!==c&&("width"!==c||g.match(/\scolspan="\d+"/i))?"style"===c?2===b?"":(d=e.trim(d.replace(/\s*(mso-[^:]+:.+?|margin\s*:\s*0cm 0cm 0pt\s*|(text-align|font-variant|line-height)\s*:\s*.+?)(;|$)\s*/gi,"")))?" "+c+'="'+d.replace(/"/g,"'")+'"':"":a:""})),c+g+h)}),c=0;3>c;c++)a=a.replace(/<([^\s>]+)(\s+[^>]*)?>\s*<\/\1>/g,function(a,b){return b.match(/^a$/i)?a:""});return a},this.cleanHTML=function(a){a=a.replace(/<!?\/?(DOCTYPE|html|body|meta)(\s+[^>]*?)?>/gi,"");var b;return a=a.replace(/<head(?:\s+[^>]*?)?>([\s\S]*?)<\/head>/i,function(a,c){return b=c.match(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/gi),""}),b&&(a=b.join("")+a),a=a.replace(/<\??xml(:\w+)?(\s+[^>]*?)?>([\s\S]*?<\/xml>)?/gi,""),p.internalScript||(a=a.replace(/<script(\s+[^>]*?)?>[\s\S]*?<\/script>/gi,"")),p.internalStyle||(a=a.replace(/<style(\s+[^>]*?)?>[\s\S]*?<\/style>/gi,"")),p.linkTag&&p.inlineScript&&p.inlineStyle||(a=a.replace(/(<(\w+))((?:\s+[\w-]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/gi,function(a,b,c,d,e){return p.linkTag||"link"!==c.toLowerCase()?(p.inlineScript||(d=d.replace(/\s+on(?:click|dblclick|mouse(down|up|move|over|out|enter|leave|wheel)|key(down|press|up)|change|select|submit|reset|blur|focus|load|unload)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/gi,"")),p.inlineStyle||(d=d.replace(/\s+(style|class)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/gi,"")),b+d+e):""})),a=a.replace(/<\/(strong|b|u|strike|em|i)>((?:\s|<br\/?>|&nbsp;)*?)<\1(\s+[^>]*?)?>/gi,"$2").replace(/<(input|select|textarea|button|marquee|iframe|frame|form|script)/gi,"<\\$1")},this.formatXHTML=function(a,b){function c(a){var c,b={};for(a=a.split(","),c=0;c<a.length;c++)b[a[c]]=!0;return b}function e(a){a=a.toLowerCase();var b=s[a];return b?b:a}function f(a,b,c){if(n[a])for(;w.last()&&o[w.last()];)g(w.last());p[a]&&w.last()===a&&g(a),(c=m[a]||!!c)||w.push(a);var d=[];d.push("<"+a),b.replace(u,function(a,b,c,e,f){b=b.toLowerCase(),d.push(" "+b+'="'+(c?c:e?e:f?f:q[b]?b:"").replace(/"/g,"'")+'"')}),d.push((c?" /":"")+">"),j(d.join(""),a,!0),"pre"===a&&(E=!0)}function g(a){var b,c;if(a)for(b=w.length-1;b>=0&&w[b]!==a;b--);else b=0;if(b>=0){for(c=w.length-1;c>=b;c--)j("</"+w[c]+">",w[c]);w.length=b}"pre"===a&&(E=!1,C--)}function h(a){j(d.domEncode(a))}function i(a){v.push(a.replace(/^[\s\r\n]+|[\s\r\n]+$/g,""))}function j(a,c,d){if(E||(a=a.replace(/(\t*\r?\n\t*)+/g,"")),E||b!==!0)v.push(a);else if(a.match(/^\s*$/))v.push(a);else{var e=n[c],f=e?c:"";e?(d&&C++,""===D&&C--):D&&C++,(f!==D||e)&&k(),v.push(a),"br"===c&&k(),!e||!m[c]&&d||C--,D=e?c:""}}function k(){if(v.push("\r\n"),C>0)for(var a=C;a--;)v.push("	")}function l(a,b,c,d){return c?(a="",(b=c.match(/ face\s*=\s*"\s*([^"]+)\s*"/i))&&(a+="font-family:"+b[1]+";"),(b=c.match(/ size\s*=\s*"\s*(\d+)\s*"/i))&&(a+="font-size:"+$[(b[1]>7?7:b[1]<1?1:b[1])-1].s+";"),(b=c.match(/ color\s*=\s*"\s*([^"]+)\s*"/i))&&(a+="color:"+b[1]+";"),(c=c.match(/ style\s*=\s*"\s*([^"]+)\s*"/i))&&(a+=c[1]),a&&(d='<span style="'+a+'">'+d+"</span>"),d):d}var x,y,A,B,z,C,D,E,m=c("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),n=c("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,table,tbody,td,tfoot,th,thead,tr,ul,script"),o=c("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),p=c("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),q=c("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),r=c("script,style"),s={b:"strong",i:"em",s:"del",strike:"del"},t=/<(?:\/([^\s>]+)|!--([^>]*?)--|([\w\-:]+)((?:"[^"]*"|'[^']*'|[^"'<>])*)\s*(\/?))>/g,u=/\s*([\w\-:]+)(?:\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s]+)))?/g,v=[],w=[];for(w.last=function(){return this[this.length-1]},z=0,C=-1,D="body",E=!1;x=t.exec(a);)y=x.index,y>z&&(z=a.substring(z,y),A?B.push(z):h(z)),z=t.lastIndex,!(y=x[1])||(y=e(y),A&&y===A&&(i(B.join("")),B=A=null),A)?A?B.push(x[0]):(y=x[3])?(y=e(y),f(y,x[4],x[5]),r[y]&&(A=y,B=[])):x[2]&&v.push(x[0]):g(y);return a.length>z&&h(a.substring(z,a.length)),g(),a=v.join(""),v=null,a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/gi,l),a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/gi,l),a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/gi,l),a=a.replace(/^(\s*\r?\n)+|(\s*\r?\n)+$/g,"")},this.toggleShowBlocktag=function(a){wa!==a&&(wa=!wa,a=e(v.body),wa?(pa+=" showBlocktag",a.addClass("showBlocktag")):(pa=pa.replace(" showBlocktag",""),a.removeClass("showBlocktag")))},this.toggleSource=function(a){var f,g,b,c,h;F!==a&&(C.find("[cmd=Source]").toggleClass("xheEnabled").toggleClass("xheActive"),b=v.body,c=e(b),a=0,h="",F?(f=d.getSource(),c.html("").removeAttr("scroll").attr("class","editMode"+pa),y?b.contentEditable="true":v.designMode="On",Da&&(d._exec("inserthtml","-"),e("#"+Ma).show().focus().hide()),h="源代码"):(d.pasteHTML('<span id="_xhe_cursor"></span>',!0),f=d.getSource(!0),a=f.indexOf('<span id="_xhe_cursor"></span>'),eb||(a=f.substring(0,a).replace(/\r/g,"").length),f=f.replace(/(\r?\n\s*|)<span id="_xhe_cursor"><\/span>(\s*\r?\n|)/,function(a,b,c){return b&&c?"\r\n":b+c
}),y?b.contentEditable="false":v.designMode="Off",c.attr("scroll","no").attr("class","sourceMode").html('<textarea id="sourceCode" wrap="soft" spellcheck="false" height="100%" />'),g=e("#sourceCode",c).blur(d.getSource)[0],h="可视化编辑"),F=!F,d.setSource(f),d.focus(),F?g.setSelectionRange?g.setSelectionRange(a,a):(g=g.createTextRange(),g.move("character",a),g.select()):d.setTextCursor(),C.find("[cmd=Source]").attr("title",h).find("span").text(h),C.find("[cmd=Source],[cmd=Preview]").toggleClass("xheEnabled"),C.find(".xheButton").not("[cmd=Source],[cmd=Fullscreen],[cmd=About]").toggleClass("xheEnabled").attr("aria-disabled",F?!0:!1),setTimeout(Ya,300))},this.showPreview=function(){var c,a=p.beforeSetSource,b=d.getSource();a&&(b=a(b)),a="<html><head>"+za+"<title>预览</title>"+(P?'<base href="'+P+'"/>':"")+"</head><body>"+b+"</body></html>",b=window.screen,b=window.open("","xhePreview","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+Math.round(.9*b.width)+",height="+Math.round(.8*b.height)+",left="+Math.round(.05*b.width)),c=b.document,c.open(),c.write(a),c.close(),b.focus()},this.toggleFullscreen=function(a){if(ua!==a){a=e("#"+ya).find(".xheLayout");var b=e("#"+ya),c=jQuery.browser.version;c=y&&(6==c||7==c),ua?(c&&Q.after(b),a.attr("style",nb),O.height(X-C.outerHeight()),e(window).scrollTop(bb),setTimeout(function(){e(window).scrollTop(bb)},10)):(c&&e("body").append(b),bb=e(window).scrollTop(),nb=a.attr("style"),a.removeAttr("style"),O.height("100%"),setTimeout($a,100)),Da?(e("#"+Ma).show().focus().hide(),setTimeout(d.focus,1)):c&&d.setTextCursor(),ua=!ua,b.toggleClass("xhe_Fullscreen"),e("html").toggleClass("xhe_Fullfix"),C.find("[cmd=Fullscreen]").toggleClass("xheActive"),setTimeout(Ya,300)}},this.showMenu=function(a,b){var c=e('<div class="xheMenu"></div>'),f=a.length,g=[];e.each(a,function(a,b){g.push("<a href=\"javascript:void('"+b.v+'\')" title="'+(b.t?b.t:b.s)+'" v="'+b.v+'" role="option" aria-setsize="'+f+'" aria-posinset="'+(a+1)+'" tabindex="0">'+b.s+"</a>")}),c.append(g.join("")),c.click(function(a){return a=a.target,e.nodeName(a,"DIV")?void 0:(d.loadBookmark(),b(e(a).closest("a").attr("v")),d.hidePanel(),!1)}).mousedown(W),d.showPanel(c),d.saveBookmark()},this.showColor=function(a){var b=e('<div class="xheColor"></div>'),c=[],f=gb.length,g=0;e.each(gb,function(a,b){0===g%7&&c.push((g>0?"</div>":"")+"<div>"),c.push("<a href=\"javascript:void('"+b+'\')" xhev="'+b+'" title="'+b+'" style="background:'+b+'" role="option" aria-setsize="'+f+'" aria-posinset="'+(g+1)+'"></a>'),g++}),c.push("</div>"),b.append(c.join("")),b.click(function(b){return b=b.target,e.nodeName(b,"A")?(d.loadBookmark(),a(e(b).attr("xhev")),d.hidePanel(),!1):void 0}).mousedown(W),d.showPanel(b),d.saveBookmark()},this.showPastetext=function(){var a=e('<div><label for="xhePastetextValue">使用键盘快捷键(Ctrl+V)把内容粘贴到方框里，按 确定</label></div><div><textarea id="xhePastetextValue" wrap="soft" spellcheck="false" style="width:300px;height:100px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="确定" /></div>'),b=e("#xhePastetextValue",a);e("#xheSave",a).click(function(){d.loadBookmark();var a=b.val();return a&&d.pasteText(a),d.hidePanel(),!1}),d.showDialog(a),d.saveBookmark()},this.showLink=function(){var f,g,h,i,j,k,a='<div><label for="xheLinkUrl">链接地址: </label><input type="text" id="xheLinkUrl" value="http://" class="xheText" /></div><div><label for="xheLinkTarget">打开方式: </label><select id="xheLinkTarget"><option selected="selected" value="">默认</option><option value="_blank">新窗口</option><option value="_self">当前窗口</option><option value="_parent">父窗口</option></select></div><div style="display:none"><label for="xheLinkText">链接文字: </label><input type="text" id="xheLinkText" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="确定" /></div>',b=ma.find("a[name]").not("[href]"),c=b.length>0;if(c&&(f=[],b.each(function(){var a=e(this).attr("name");f.push('<option value="#'+a+'">'+a+"</option>")}),a=a.replace(/(<div><label for="xheLinkTarget)/,'<div><label for="xheLinkAnchor">页内锚点: </label><select id="xheLinkAnchor"><option value="">未选择</option>'+f.join("")+"</select></div>$1")),a=e(a),g=d.getParent("a"),h=e("#xheLinkText",a),i=e("#xheLinkUrl",a),j=e("#xheLinkTarget",a),b=e("#xheSave",a),k=d.getSelect(),c&&a.find("#xheLinkAnchor").change(function(){var a=e(this).val();""!=a&&i.val(a)}),1===g.length){if(!g.attr("href"))return M=null,d.exec("Anchor");i.val(U(g,"href")),j.attr("value",g.attr("target"))}else""===k&&h.val(p.defLinkText).closest("div").show();p.upLinkUrl&&d.uploadInit(i,p.upLinkUrl,p.upLinkExt),b.click(function(){var a,b,c,f,l,m,n;if(d.loadBookmark(),a=i.val(),(""===a||0===g.length)&&d._exec("unlink"),""!==a&&"http://"!==a)if(b=a.split(" "),c=j.val(),f=h.val(),b.length>1){d._exec("unlink"),k=d.getSelect(),l='<a href="xhe_tmpurl"',m=[],""!==c&&(l+=' target="'+c+'"'),l+=">xhe_tmptext</a>",f=""!==k?k:f?f:a;for(n in b)a=b[n],""!==a&&(a=a.split("||"),c=l,c=c.replace("xhe_tmpurl",a[0]),c=c.replace("xhe_tmptext",a[1]?a[1]:f),m.push(c));d.pasteHTML(m.join("&nbsp;"))}else a=b[0].split("||"),f||(f=a[0]),f=a[1]?a[1]:""!==k?"":f?f:a[0],0===g.length?(f?d.pasteHTML('<a href="#xhe_tmpurl">'+f+"</a>"):d._exec("createlink","#xhe_tmpurl"),g=e('a[href$="#xhe_tmpurl"]',v)):f&&!Y&&g.text(f),U(g,"href",a[0]),""!==c?g.attr("target",c):g.removeAttr("target");return d.hidePanel(),!1}),d.showDialog(a),d.saveBookmark()},this.showAnchor=function(){var a=e('<div><label for="xheAnchorName">锚点名称: </label><input type="text" id="xheAnchorName" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="确定" /></div>'),b=d.getParent("a"),c=e("#xheAnchorName",a),f=e("#xheSave",a);if(1===b.length){if(b.attr("href"))return M=null,d.exec("Link");c.val(b.attr("name"))}f.click(function(){d.loadBookmark();var a=c.val();return a?0===b.length?d.pasteHTML('<a name="'+a+'"></a>'):b.attr("name",a):1===b.length&&b.remove(),d.hidePanel(),!1}),d.showDialog(a),d.saveBookmark()},this.showImg=function(){var n,o,a=e('<div><label for="xheImgUrl">图片文件: </label><input type="text" id="xheImgUrl" value="http://" class="xheText" /></div><div><div><label for="xheImgAlt">替换文本: </label><input type="text" id="xheImgAlt" /></div><div><label for="xheImgAlign">对齐方式: </label><select id="xheImgAlign"><option selected="selected" value="">默认</option><option value="left">左对齐</option><option value="right">右对齐</option><option value="top">顶端</option><option value="middle">居中</option><option value="baseline">基线</option><option value="bottom">底边</option></select></div><div><label for="xheImgWidth">宽　　度: </label><input type="text" id="xheImgWidth" style="width:40px;" /> <label for="xheImgHeight">高　　度: </label><input type="text" id="xheImgHeight" style="width:40px;" /></div><div><label for="xheImgBorder">边框大小: </label><input type="text" id="xheImgBorder" style="width:40px;" /></div><div><label for="xheImgHspace">水平间距: </label><input type="text" id="xheImgHspace" style="width:40px;" /> <label for="xheImgVspace">垂直间距: </label><input type="text" id="xheImgVspace" style="width:40px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="确定" /></div>'),b=d.getParent("img"),c=e("#xheImgUrl",a),f=e("#xheImgAlt",a),g=e("#xheImgAlign",a),h=e("#xheImgWidth",a),i=e("#xheImgHeight",a),j=e("#xheImgBorder",a),k=e("#xheImgVspace",a),l=e("#xheImgHspace",a),m=e("#xheSave",a);1===b.length&&(c.val(U(b,"src")),f.val(b.attr("alt")),g.val(b.attr("align")),h.val(b.attr("width")),i.val(b.attr("height")),j.val(b.attr("border")),n=b.attr("vspace"),o=b.attr("hspace"),k.val(0>=n?"":n),l.val(0>=o?"":o)),p.upImgUrl&&d.uploadInit(c,p.upImgUrl,p.upImgExt),m.click(function(){var a,m,n,o,p,q,r,s,t,u,w,x;if(d.loadBookmark(),a=c.val(),""!==a&&"http://"!==a)if(m=a.split(" "),n=f.val(),o=g.val(),p=h.val(),q=i.val(),r=j.val(),s=k.val(),t=l.val(),m.length>1){u='<img src="xhe_tmpurl"',w=[],""!==n&&(u+=' alt="'+n+'"'),""!==o&&(u+=' align="'+o+'"'),""!==p&&(u+=' width="'+p+'"'),""!==q&&(u+=' height="'+q+'"'),""!==r&&(u+=' border="'+r+'"'),""!==s&&(u+=' vspace="'+s+'"'),""!==t&&(u+=' hspace="'+t+'"'),u+=" />";for(x in m)a=m[x],""!==a&&(a=a.split("||"),n=u,n=n.replace("xhe_tmpurl",a[0]),a[1]&&(n='<a href="'+a[1]+'" target="_blank">'+n+"</a>"),w.push(n));d.pasteHTML(w.join("&nbsp;"))}else 1===m.length&&(a=m[0],""!==a&&(a=a.split("||"),0===b.length&&(d.pasteHTML('<img src="'+a[0]+'#xhe_tmpurl" />'),b=e('img[src$="#xhe_tmpurl"]',v)),U(b,"src",a[0]),""!==n&&b.attr("alt",n),""!==o?b.attr("align",o):b.removeAttr("align"),""!==p?b.attr("width",p):b.removeAttr("width"),""!==q?b.attr("height",q):b.removeAttr("height"),""!==r?b.attr("border",r):b.removeAttr("border"),""!==s?b.attr("vspace",s):b.removeAttr("vspace"),""!==t?b.attr("hspace",t):b.removeAttr("hspace"),a[1]&&(m=b.parent("a"),0===m.length&&(b.wrap("<a></a>"),m=b.parent("a")),U(m,"href",a[1]),m.attr("target","_blank"))));else 1===b.length&&b.remove();return d.hidePanel(),!1}),d.showDialog(a),d.saveBookmark()},this.showEmbed=function(a,b,c,f,g,h,i){b=e(b);var j=d.getParent('embed[type="'+c+'"],embed[classid="'+f+'"]'),k=e("#xhe"+a+"Url",b),l=e("#xhe"+a+"Width",b),m=e("#xhe"+a+"Height",b);a=e("#xheSave",b),h&&d.uploadInit(k,h,i),1===j.length&&(k.val(U(j,"src")),l.val(j.attr("width")),m.val(j.attr("height"))),a.click(function(){var a,b,h,i,n,o,p,q;if(d.loadBookmark(),a=k.val(),""!==a&&"http://"!==a)if(b=l.val(),h=m.val(),i=/^\d+%?$/,i.test(b)||(b=412),i.test(h)||(h=300),n='<embed type="'+c+'" classid="'+f+'" src="xhe_tmpurl"'+g,i=a.split(" "),i.length>1){n+="",p=[],n+=' width="xhe_width" height="xhe_height" />';for(q in i)a=i[q].split("||"),o=n,o=o.replace("xhe_tmpurl",a[0]),o=o.replace("xhe_width",a[1]?a[1]:b),o=o.replace("xhe_height",a[2]?a[2]:h),""!==a&&p.push(o);d.pasteHTML(p.join("&nbsp;"))}else 1===i.length&&(a=i[0].split("||"),0===j.length&&(d.pasteHTML(n.replace("xhe_tmpurl",a[0]+"#xhe_tmpurl")+" />"),j=e('embed[src$="#xhe_tmpurl"]',v)),U(j,"src",a[0]),j.attr("width",a[1]?a[1]:b),j.attr("height",a[2]?a[2]:h));else 1===j.length&&j.remove();return d.hidePanel(),!1}),d.showDialog(b),d.saveBookmark()},this.showEmot=function(a){var f,g,h,i,j,k,l,m,n,o,b=p.admin,c=e('<div class="xheEmot"></div>');if(a=a?a:db?db:"default",f=Na[a],g=ea+a+"/",h=0,i=[],j="",j=f.width,k=f.height,l=f.line,m=f.count,f=f.list,m)for(f=1;m>=f;f++)h++,i.push("<a href=\"javascript:void('"+f+'\')" style="background-image:url('+g+f+'.gif);" emot="'+a+","+f+'" xhev="" title="'+f+'" role="option">&nbsp;</a>'),0===h%l&&i.push("<br />");else e.each(f,function(c,d){h++,i.push("<a href=\"javascript:void('"+d+'\')" style="background-image:url('+b+g+c+'.gif);" emot="'+a+","+c+'" title="'+d+'" xhev="'+d+'" role="option">&nbsp;</a>'),0===h%l&&i.push("<br />")});m=l*(j+12),f=.75*m,Math.ceil(h/l)*(k+12)<=f&&(f=""),j=e("<style>"+(f?".xheEmot div{width:"+(m+20)+"px;height:"+f+"px;}":"")+".xheEmot div a{width:"+j+"px;height:"+k+"px;}</style><div>"+i.join("")+"</div>").click(function(a){a=a.target;var b=e(a);return e.nodeName(a,"A")?(d.pasteHTML('<img emot="'+b.attr("emot")+'" alt="'+b.attr("xhev")+'">'),d.hidePanel(),!1):void 0}).mousedown(W),c.append(j),n=0,o=['<ul role="tablist">'],e.each(Na,function(b,c){n++,o.push("<li"+(a===b?' class="cur"':"")+' role="presentation"><a href="javascript:void(\''+c.name+'\')" group="'+b+'" role="tab" tabindex="0">'+c.name+"</a></li>")}),n>1&&(o.push('</ul><br style="clear:both;" />'),j=e(o.join("")).click(function(a){return db=e(a.target).attr("group"),d.exec("Emot"),!1}).mousedown(W),c.append(j)),d.showPanel(c)},this.showTable=function(){var a=e('<div><label for="xheTableRows">行　　数: </label><input type="text" id="xheTableRows" style="width:40px;" value="3" /> <label for="xheTableColumns">列　　数: </label><input type="text" id="xheTableColumns" style="width:40px;" value="2" /></div><div><label for="xheTableHeaders">标题单元: </label><select id="xheTableHeaders"><option selected="selected" value="">无</option><option value="row">第一行</option><option value="col">第一列</option><option value="both">第一行和第一列</option></select></div><div><label for="xheTableWidth">宽　　度: </label><input type="text" id="xheTableWidth" style="width:40px;" value="200" /> <label for="xheTableHeight">高　　度: </label><input type="text" id="xheTableHeight" style="width:40px;" value="" /></div><div><label for="xheTableBorder">边框大小: </label><input type="text" id="xheTableBorder" style="width:40px;" value="1" /></div><div><label for="xheTableCellSpacing">表格间距: </label><input type="text" id="xheTableCellSpacing" style="width:40px;" value="1" /> <label for="xheTableCellPadding">表格填充: </label><input type="text" id="xheTableCellPadding" style="width:40px;" value="1" /></div><div><label for="xheTableAlign">对齐方式: </label><select id="xheTableAlign"><option selected="selected" value="">默认</option><option value="left">左对齐</option><option value="center">居中</option><option value="right">右对齐</option></select></div><div><label for="xheTableCaption">表格标题: </label><input type="text" id="xheTableCaption" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="确定" /></div>'),b=e("#xheTableRows",a),c=e("#xheTableColumns",a),f=e("#xheTableHeaders",a),g=e("#xheTableWidth",a),h=e("#xheTableHeight",a),i=e("#xheTableBorder",a),j=e("#xheTableCellSpacing",a),k=e("#xheTableCellPadding",a),l=e("#xheTableAlign",a),m=e("#xheTableCaption",a);e("#xheSave",a).click(function(){d.loadBookmark();var a=m.val(),e=i.val(),n=b.val(),o=c.val(),p=f.val(),q=g.val(),r=h.val(),s=j.val(),t=k.val(),u=l.val();if(e="<table"+(""!==e?' border="'+e+'"':"")+(""!==q?' width="'+q+'"':"")+(""!==r?' height="'+r+'"':"")+(""!==s?' cellspacing="'+s+'"':"")+(""!==t?' cellpadding="'+t+'"':"")+(""!==u?' align="'+u+'"':"")+">",""!==a&&(e+="<caption>"+a+"</caption>"),"row"===p||"both"===p){for(e+="<tr>",a=0;o>a;a++)e+='<th scope="col"></th>';e+="</tr>",n--}for(e+="<tbody>",a=0;n>a;a++){for(e+="<tr>",q=0;o>q;q++)e+=0!==q||"col"!==p&&"both"!==p?"<td></td>":'<th scope="row"></th>';e+="</tr>"}return e+="</tbody></table>",d.pasteHTML(e),d.hidePanel(),!1}),d.showDialog(a),d.saveBookmark()},this.showAbout=function(){var a=e('<div style="font:12px Arial;width:245px;word-wrap:break-word;word-break:break-all;outline:none;" role="dialog" tabindex="-1"><p><span style="font-size:20px;color:#1997DF;">xhEditor</span><br />v1.1.10 (build 110904)</p><p>xhEditor是基于jQuery开发的跨平台轻量可视化XHTML编辑器，基于<a href="http://www.gnu.org/licenses/lgpl.html" target="_blank">LGPL</a>开源协议发布。</p><p>Copyright &copy; <a href="http://xheditor.com/" target="_blank">xhEditor.com</a>. All rights reserved.</p></div>');a.find("p").attr("role","presentation"),d.showDialog(a,!0),setTimeout(function(){a.focus()},100)},this.checkInner=function(){var a=e.trim(this.stripHtml()),b=a.length,c=Math.abs(p.wordLimit-b);p.wordLimit>=b?e("#"+p.showArea).html("已输入长度:<b class='ceb2'>"+b+"</b>"+",还可以输入:"+c+"字"):e("#"+p.showArea).text("可输入:"+p.wordLimit+"字,已超出长度:"+c+"字")},this.stripHtml=function(){var a=this.getSource();return a.replace(new RegExp("<(.+?)>([^<>]*)","igm"),"$2").replace(new RegExp("&nbsp;","gm"),"").replace(new RegExp("&lt;","gm"),"<").replace(new RegExp("&gt","gm"),">").replace(new RegExp("&quot;","gm"),'"')},this.addShortcuts=function(a,b){a=a.toLowerCase(),va[a]===ha&&(va[a]=[]),va[a].push(b)},this.delShortcuts=function(a){delete va[a]},this.uploadInit=function(a,b,c){function f(b){V(b,"string")&&(b=[b]);var d,f,c=!1,e=b.length,g=[];for((d=p.onUpload)&&d(b),d=0;e>d;d++)f=b[d],f=V(f,"string")?f:f.url,"!"===f.substr(0,1)&&(c=!0,f=f.substr(1)),g.push(f);a.val(g.join(" ")),c&&a.closest(".xheDialog").find("#xheSave").click()}var k,g=e('<span class="xheUpload"><input type="text" style="visibility:hidden;" tabindex="-1" /><input type="button" value="'+p.upBtnText+'" class="xheBtn" tabindex="-1" /></span>'),h=e(".xheBtn",g),i=p.html5Upload,j=i?p.upMultiple:1;a.after(g),h.before(a),b=b.replace(/{editorRoot}/gi,T),"!"===b.substr(0,1)?h.click(function(){d.showIframeModal("上传文件",b.substr(1),f,null,null)}):(g.append('<input type="file"'+(j>1?' multiple=""':"")+' class="xheFile" size="13" name="filedata" tabindex="-1" />'),k=e(".xheFile",g),k.change(function(){d.startUpload(k[0],b,c,f)}),setTimeout(function(){a.closest(".xheDialog").bind("dragenter dragover",W).bind("drop",function(a){a=a.originalEvent.dataTransfer;var e;return i&&a&&(e=a.files)&&e.length>0&&d.startUpload(e,b,c,f),!1})},10))},this.startUpload=function(a,b,c,g){function n(k,q){var r=Object,t=!1;try{r=eval("("+k+")")}catch(s){}return r.err===ha||r.msg===ha?alert(b+" 上传接口发生错误！\r\n\r\n返回的错误内容为: \r\n\r\n"+k):r.err?alert(r.err):(m.push(r.msg),t=!0),(!t||q)&&d.removeModal(),q&&t&&g(m),t}var l,o,m=[],j=p.html5Upload,i=j?p.upMultiple:1,f=e('<div style="padding:22px 0;text-align:center;line-height:30px;">文件上传中，请稍候……<br /></div>'),h='<img src="'+Ha+'img/loading.gif">';if(j&&(!a.nodeType||(l=a.files)&&l[0].fileName)){if(l||(l=a),a=l.length,a>i)return alert("请不要一次上传超过"+i+"个文件"),void 0;for(i=0;a>i;i++)if(!kb(l[i].fileName,c))return;o=e('<div class="xheProgress"><div><span>0%</span></div></div>'),f.append(o),c=new d.html5Upload("filedata",l,b,n,function(a){if(a.loaded>=0){var b=Math.round(100*a.loaded/a.total)+"%";e("div",o).css("width",b),e("span",o).text(b+" ( "+lb(a.loaded)+" / "+lb(a.total)+" )")}else o.replaceWith(h)})}else{if(!kb(a.value,c))return;f.append(h),c=new d.html4Upload(a,b,n)}d.showModal("文件上传中(Esc取消上传)",f,320,150),c.start()},this.html4Upload=function(a,b,c){var d="jUploadFrame"+(new Date).getTime(),f=this,g=e('<iframe name="'+d+'" class="xheHideArea" />').appendTo("body"),h=e('<form action="'+b+'" target="'+d+'" method="post" enctype="multipart/form-data" class="xheHideArea"></form>').appendTo("body"),i=e(a),j=i.clone().attr("disabled","true");return i.before(j).appendTo(h),this.remove=function(){null!==f&&(j.before(i).remove(),g.remove(),h.remove(),f=null)},this.onLoad=function(){var a=g[0].contentWindow.document,b=e(a.body).text();a.write(""),f.remove(),c(b,!0)},this.start=function(){h.submit(),g.load(f.onLoad)},this},this.html5Upload=function(a,b,c,d,e){function f(b,c,d,e){h=new XMLHttpRequest,upload=h.upload,h.onreadystatechange=function(){4===h.readyState&&d(h.responseText)},upload?upload.onprogress=function(a){e(a.loaded)}:e(-1),h.open("POST",c),h.setRequestHeader("Content-Type","application/octet-stream"),h.setRequestHeader("Content-Disposition",'attachment; name="'+a+'"; filename="'+b.fileName+'"'),h.sendAsBinary?h.sendAsBinary(b.getAsBinary()):h.send(b)}function g(a){e&&e({loaded:k+a,total:l})}for(var h,i=0,j=b.length,k=0,l=0,m=this,n=0;j>n;n++)l+=b[n].fileSize;this.remove=function(){h&&(h.abort(),h=null)},this.uploadNext=function(a){a&&(k+=b[i-1].fileSize,g(0)),(!a||a&&d(a,i===j)===!0)&&j>i&&f(b[i++],c,m.uploadNext,function(a){g(a)})},this.start=function(){m.uploadNext()}},this.showIframeModal=function(a,b,c,g,n,m){function j(){try{h.callback=i,h.unloadme=d.removeModal,e(h.document).keydown(Qa),o=h.name}catch(a){}}function i(a){h.document.write(""),d.removeModal(),null!=a&&c(a)}var l,f,h,o;b=e('<iframe frameborder="0" src="'+b.replace(/{editorRoot}/gi,T)+(/\?/.test(b)?"&":"?")+"parenthost="+location.host+'" style="width:100%;height:100%;display:none;" /><div class="xheModalIfmWait"></div>'),l=b.eq(0),f=b.eq(1),d.showModal(a,b,g,n,m),h=l[0].contentWindow,j(),l.load(function(){return j(),o?(o=eval("("+unescape(o)+")"),i(o)):(f.is(":visible")&&(l.show().focus(),f.remove()),void 0)})},this.showModal=function(a,b,c,f,g){return Ga?!1:(d.panelState=Z,Z=!1,ka=p.layerShadow,c=c?c:p.modalWidth,f=f?f:p.modalHeight,S=e('<div class="xheModal" style="width:'+(c-1)+"px;height:"+f+"px;margin-left:-"+Math.ceil(c/2)+"px;"+(y&&7>Ca?"":"margin-top:-"+Math.ceil(f/2)+"px")+'">'+(p.modalTitle?'<div class="xheModalTitle"><span class="xheModalClose" title="关闭 (Esc)" tabindex="0" role="button"></span>'+a+"</div>":"")+'<div class="xheModalContent"></div></div>').appendTo("body"),Sa=e('<div class="xheModalOverlay"></div>').appendTo("body"),ka>0&&(Ra=e('<div class="xheModalShadow" style="width:'+S.outerWidth()+"px;height:"+S.outerHeight()+"px;margin-left:-"+(Math.ceil(c/2)-ka-2)+"px;"+(y&&7>Ca?"":"margin-top:-"+(Math.ceil(f/2)-ka-2)+"px")+'"></div>').appendTo("body")),e(".xheModalContent",S).css("height",f-(p.modalTitle?e(".xheModalTitle").outerHeight():0)).html(b),y&&6===Ca&&(Ta=e("select:visible").css("visibility","hidden")),e(".xheModalClose",S).click(d.removeModal),Sa.show(),ka>0&&Ra.show(),S.show(),setTimeout(function(){S.find("a,input[type=text],textarea").filter(":visible").filter(function(){return"hidden"!==e(this).css("visibility")}).eq(0).focus()},10),Ga=!0,Ua=g,void 0)},this.removeModal=function(){Ta&&Ta.css("visibility","visible"),S.html("").remove(),ka>0&&Ra.remove(),Sa.remove(),Ua&&Ua(),Ga=!1,Z=d.panelState},this.showDialog=function(a,b){var h,i,c=e('<div class="xheDialog"></div>'),f=e(a),g=e("#xheSave",f);1===g.length&&(f.find("input[type=text],select").keypress(function(a){return 13===a.which?(g.click(),!1):void 0}),f.find("textarea").keydown(function(a){return a.ctrlKey&&13===a.which?(g.click(),!1):void 0}),g.after(' <input type="button" id="xheCancel" value="取消" />'),e("#xheCancel",f).click(d.hidePanel),p.clickCancelDialog||(Fa=!1,h=e('<div class="xheFixCancel"></div>').appendTo("body").mousedown(W),i=O.offset(),h.css({left:i.left,top:i.top,width:O.outerWidth(),height:O.outerHeight()})),c.mousedown(function(){xa=!0})),c.append(f),d.showPanel(c,b)},this.showPanel=function(a,b){var c,d,f,g;return M.target?(L.html("").append(a).css("left",-999).css("top",-999),ja=e(M.target).closest("a").addClass("xheActive"),c=ja.offset(),d=c.left,c=c.top,c+=ja.outerHeight()-1,sa.css({left:d+1,top:c,width:ja.width()}).show(),f=document.documentElement,g=document.body,d+L.outerWidth()>(window.pageXOffset||f.scrollLeft||g.scrollLeft)+(f.clientWidth||g.clientWidth)&&(d-=L.outerWidth()-ja.outerWidth()),f=p.layerShadow,f>0&&ra.css({left:d+f,top:c+f,width:L.outerWidth(),height:L.outerHeight()}).show(),L.css({left:d,top:c}).show(),b||setTimeout(function(){L.find("a,input[type=text],textarea").filter(":visible").filter(function(){return"hidden"!==e(this).css("visibility")}).eq(0).focus()},10),cb=Z=!0,void 0):!1},this.hidePanel=function(){Z&&(ja.removeClass("xheActive"),ra.hide(),sa.hide(),L.hide(),Z=!1,Fa||(e(".xheFixCancel").remove(),Fa=!0),cb=xa=!1,da=null,d.focus(),d.loadBookmark())},this.exec=function(a){var b,c,i,j,k;if(d.hidePanel(),b=ta[a],!b)return!1;if(null===M&&(M={},c=C.find(".xheButton[cmd="+a+"]"),1===c.length&&(M.target=c)),b.e)b.e.call(d);else switch(a=a.toLowerCase()){case"cut":try{if(v.execCommand(a),!v.queryCommandSupported(a))throw"Error"}catch(f){alert("您的浏览器安全设置不允许使用剪切操作，请使用键盘快捷键(Ctrl + X)来完成")}break;case"copy":try{if(v.execCommand(a),!v.queryCommandSupported(a))throw"Error"}catch(g){alert("您的浏览器安全设置不允许使用复制操作，请使用键盘快捷键(Ctrl + C)来完成")}break;case"paste":try{if(v.execCommand(a),!v.queryCommandSupported(a))throw"Error"}catch(h){alert("您的浏览器安全设置不允许使用粘贴操作，请使用键盘快捷键(Ctrl + V)来完成")}break;case"pastetext":window.clipboardData?d.pasteText(window.clipboardData.getData("Text",!0)):d.showPastetext();break;case"blocktag":i=[],e.each(zb,function(a,b){i.push({s:"<"+b.n+">"+b.t+"</"+b.n+">",v:"<"+b.n+">",t:b.t})}),d.showMenu(i,function(a){d._exec("formatblock",a)});break;case"fontface":j=[],e.each(Ab,function(a,b){b.c=b.c?b.c:b.n,j.push({s:'<span style="font-family:'+b.c+'">'+b.n+"</span>",v:b.c,t:b.n})}),d.showMenu(j,function(a){d._exec("fontname",a)});break;case"fontsize":k=[],e.each($,function(a,b){k.push({s:'<span style="font-size:'+b.s+';">'+b.t+"("+b.s+")</span>",v:a+1,t:b.t})}),d.showMenu(k,function(a){d._exec("fontsize",a)});break;case"fontcolor":d.showColor(function(a){d._exec("forecolor",a)});break;case"backcolor":d.showColor(function(a){y?d._exec("backcolor",a):(Xa(!0),d._exec("hilitecolor",a),Xa(!1))});break;case"align":d.showMenu(Bb,function(a){d._exec(a)});break;case"list":d.showMenu(Cb,function(a){d._exec(a)});break;case"link":d.showLink();break;case"anchor":d.showAnchor();break;case"img":d.showImg();break;case"flash":d.showEmbed("Flash",'<div><label for="xheFlashUrl">动画文件: </label><input type="text" id="xheFlashUrl" value="http://" class="xheText" /></div><div><label for="xheFlashWidth">宽　　度: </label><input type="text" id="xheFlashWidth" style="width:40px;" value="480" /> <label for="xheFlashHeight">高　　度: </label><input type="text" id="xheFlashHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="确定" /></div>',"application/x-shockwave-flash","clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000",' wmode="opaque" quality="high" menu="false" play="true" loop="true" allowfullscreen="true"',p.upFlashUrl,p.upFlashExt);break;case"media":d.showEmbed("Media",'<div><label for="xheMediaUrl">媒体文件: </label><input type="text" id="xheMediaUrl" value="http://" class="xheText" /></div><div><label for="xheMediaWidth">宽　　度: </label><input type="text" id="xheMediaWidth" style="width:40px;" value="480" /> <label for="xheMediaHeight">高　　度: </label><input type="text" id="xheMediaHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="确定" /></div>',"application/x-mplayer2","clsid:6bf52a52-394a-11d3-b153-00c04f79faa6",' enablecontextmenu="false" autostart="false"',p.upMediaUrl,p.upMediaExt);break;case"hr":d.pasteHTML("<hr />");break;case"emot":d.showEmot();break;case"table":d.showTable();break;case"source":d.toggleSource();break;case"preview":d.showPreview();break;case"print":la.print();break;case"fullscreen":d.toggleFullscreen();break;case"about":d.showAbout();break;default:d._exec(a)}M=null},this._exec=function(a,b,c){return c||d.focus(),b!==ha?v.execCommand(a,!1,b):v.execCommand(a,!1,null)}},Ea.settings={skin:"default",tools:"full",clickCancelDialog:!0,linkTag:!1,internalScript:!1,inlineScript:!1,internalStyle:!0,inlineStyle:!0,showBlocktag:!1,forcePtag:!0,upLinkExt:"zip,rar,txt",upImgExt:"jpg,jpeg,gif,png",upFlashExt:"swf",upMediaExt:"wmv,avi,wma,mp3,mid",modalWidth:350,modalHeight:220,modalTitle:!0,defLinkText:"点击打开链接",layerShadow:3,emotMark:!1,admin:"",upBtnText:"上传",cleanPaste:2,hoverExecDelay:100,html5Upload:!0,upMultiple:99,innerCheck:!1,wordLimit:1e3,showArea:"length_show"},window.xheditor=Ea,e(function(){e.fn.oldVal=e.fn.val,e.fn.val=function(a){var c,b=this;return a===ha?b[0]&&(c=b[0].xheditor)?c.getSource():b.oldVal():b.each(function(){(c=this.xheditor)?c.setSource(a):b.oldVal(a)})},e("textarea").each(function(){var a=e(this),b=a.attr("class");b&&(b=b.match(/(?:^|\s)xheditor(?:\-(m?full|medium|simple|mini))?(?:\s|$)/i))&&a.xheditor(b[1]?{tools:b[1]}:null)})})}(jQuery);